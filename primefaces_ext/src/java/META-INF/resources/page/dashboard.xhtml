<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Facelet Title</title>
        <script>
            function dashboardReorder() {
                var newOrder = '';
                $('.ui-dashboard').children().each(function (column) {
                    $(this).children().each(function (item) {
                        if ($(this).css('display') !== 'none') {
                            newOrder += column + ',' + getId($(this).attr('id')) + ',' + item + '|';
                        }
                    });
                });
                $('input[name="newDashboardOrder"]').val(newOrder.substring(0, newOrder.length - 1));
                console.log($('input[name="newDashboardOrder"]').val());
            }

            function getId(uiid) {
                var arr = uiid.split(':');
                return arr[arr.length - 1];
            }
        </script>
    </h:head>
    <h:body> 
        <h:form>
            <p:growl id="msgs" showDetail="true" />
            <p:commandButton value="Restore Dashboard" actionListener="#{dashboardMB.restoreDashboard()}" ajax="false"/>
            <p:remoteCommand name="updateDashboard" onstart="dashboardReorder();" actionListener="#{dashboardMB.updateOrder}"/>
            <input type="hidden" name="newDashboardOrder"/>
            <p:dashboard binding="#{dashboardMB.dashboard}">
                <p:ajax event="reorder" oncomplete="updateDashboard();" update="msgs" />
            </p:dashboard>
        </h:form>
    </h:body>
</html>

